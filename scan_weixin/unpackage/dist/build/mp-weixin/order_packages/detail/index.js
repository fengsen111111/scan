(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["order_packages/detail/index"],{"10ce":function(o,t,e){"use strict";e.r(t);var n=e("fe1f"),r=e.n(n);for(var i in n)["default"].indexOf(i)<0&&function(o){e.d(t,o,(function(){return n[o]}))}(i);t["default"]=r.a},5816:function(o,t,e){},"6bb4":function(o,t,e){"use strict";e.r(t);var n=e("9aa4"),r=e("10ce");for(var i in r)["default"].indexOf(i)<0&&function(o){e.d(t,o,(function(){return r[o]}))}(i);e("f532");var s=e("828b"),u=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=u.exports},"848a":function(o,t,e){"use strict";(function(o,t){var n=e("47a9");e("224c");n(e("3240"));var r=n(e("6bb4"));o.__webpack_require_UNI_MP_PLUGIN__=e,t(r.default)}).call(this,e("3223")["default"],e("df3c")["createPage"])},"9aa4":function(o,t,e){"use strict";e.d(t,"b",(function(){return r})),e.d(t,"c",(function(){return i})),e.d(t,"a",(function(){return n}));var n={uPopup:function(){return Promise.all([e.e("common/vendor"),e.e("node-modules/uview-ui/components/u-popup/u-popup")]).then(e.bind(null,"4589"))},uIcon:function(){return Promise.all([e.e("common/vendor"),e.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(e.bind(null,"5c12"))},uEmpty:function(){return Promise.all([e.e("common/vendor"),e.e("node-modules/uview-ui/components/u-empty/u-empty")]).then(e.bind(null,"11a3"))}},r=function(){var o=this,t=o.$createElement,e=(o._self._c,o.discountList.length),n=!o.discountList||0===o.discountList.length,r=!o.discountList||0===o.discountList.length,i=o.__map(o.discountList,(function(t,e){var n=o.__get_orig(t),r="a"===t.discount_type?t.top_price.replace(".00",""):null,i="a"===t.discount_type?t.data.replace(".00",""):null;return{$orig:n,g3:r,g4:i}}));o._isMounted||(o.e0=function(t){o.discountShow=!0},o.e1=function(t){o.payShow=!1},o.e2=function(t){o.payShow=!1},o.e3=function(t){o.discountShow=!1}),o.$mp.data=Object.assign({},{$root:{g0:e,g1:n,g2:r,l0:i}})},i=[]},f532:function(o,t,e){"use strict";var n=e("5816"),r=e.n(n);r.a},fe1f:function(o,t,e){"use strict";(function(o){var n=e("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(e("7ca3"));function i(o,t){var e=Object.keys(o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(o);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),e.push.apply(e,n)}return e}function s(o){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?i(Object(e),!0).forEach((function(t){(0,r.default)(o,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(e)):i(Object(e)).forEach((function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(e,t))}))}return o}var u={data:function(){return{payShow:!1,payType:1,orderInfo:{},userMoney:0,payFlag:!0,time_status:"a",pay_status:"a",statusBarHeight:"20",discountList:[],discountShow:!1,checkValue:[],shopInfo:{},coupon_obj:{},moneyObj:{},optionParams:{}}},onLoad:function(t){var e=this;this.optionParams=t,this.time_status=t.time_status,this.pay_status=t.pay_status,this.$request("/food/Order/userGetOrderDetail",{order_id:t.id}).then((function(o){e.orderInfo=o,e.selectCount()}));var n=this;o.getSystemInfo({success:function(o){n.statusBarHeight=o.statusBarHeight||20}})},methods:{changePayData:function(){var o=this,t=[];this.orderInfo.goods_list.length&&(t=this.orderInfo.goods_list.map((function(o){return(0,r.default)({goods_type:"Y"===o.is_group?"b":"a",goods_id:o.goods_id,number:o.number,choice_des:o.choice_des},o.group_goods?"group_goods":"",o.group_goods)}))),this.$request("/food/Order/computePayData",{goods_list:t,coupon_id:this.coupon_obj.id,pay_type:1===this.checkValue[0]?"b":"a"}).then((function(t){o.moneyObj=t}))},useCouponEven:function(o){this.coupon_obj=o,this.discountShow=!1,this.changePayData()},getCoupon:function(o){var t=this;this.$request("/food/Coupon/hasCoupon",{coupon_id:o.id}).then((function(){t.selectCount()}))},selectCount:function(){var t=this;if(!o.getStorageSync("token"))return!1;console.log("订单详情",this.orderInfo);var e=[];this.orderInfo.goods_list.length&&(e=this.orderInfo.goods_list.map((function(o){return(0,r.default)({goods_type:"Y"===o.is_group?"b":"a",goods_id:o.goods_id,number:o.number,choice_des:o.choice_des},o.group_goods?"group_goods":"",o.group_goods)}))),this.$request("/food/Coupon/getOrderCoupon",{store_id:this.orderInfo.store_id,goods_list:e}).then((function(o){t.discountList=o.list}))},goBack:function(){o.switchTab({url:"/pages/Order/index"})},changePayType:function(o){this.payType=o},addMenu:function(){if(!this.orderInfo.store_id)return o.showToast({title:"请等待数据加载后重试",icon:"none",duration:2e3}),!1;this.$nav("/home_packages/shop_detail/index",{id:this.orderInfo.store_id,type:"add",orderId:this.orderInfo.id,canwei:this.orderInfo.table_code})},goPay:function(){var o=this;this.$request("/food/User/getUserInfo").then((function(t){o.userMoney=t.money})),this.payShow=!0},confirm:function(){var t=this;if(this.payFlag){this.payFlag=!1;var e="";1===this.payType?e=1===this.checkValue[0]?"d":"c":2===this.payType&&(e=1===this.checkValue[0]?"b":"a"),this.$request("/food/Order/payOrder",{order_id:this.orderInfo.id,coupon_id:this.coupon_obj.id,pay_type:e}).then((function(e){1===e.result?(o.showToast({title:"支付成功",icon:"success",duration:2e3}),t.payShow=!1,t.$request("/food/Order/userGetOrderDetail",{order_id:t.orderInfo.id}).then((function(o){t.orderInfo=o})),t.payFlag=!0):3===e.result?o.requestPayment(s(s({provider:"wxpay"},e.pay_data),{},{success:function(o){t.payShow=!1,t.$request("/food/Order/userGetOrderDetail",{order_id:t.orderInfo.id}).then((function(o){t.orderInfo=o})),t.payFlag=!0},fail:function(){o.showToast({title:"用户取消支付",icon:"error"}),t.payFlag=!0}})):t.payFlag=!0})).catch((function(){t.payShow=!1,t.$request("/food/Order/userGetOrderDetail",{order_id:t.optionParams.id}).then((function(o){t.orderInfo=o,t.selectCount()})),t.payFlag=!0}))}}}};t.default=u}).call(this,e("df3c")["default"])}},[["848a","common/runtime","common/vendor"]]]);