(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["home_packages/shop_detail/index"],{"191e":function(o,e,t){"use strict";t.r(e);var i=t("ce23"),n=t.n(i);for(var s in i)["default"].indexOf(s)<0&&function(o){t.d(e,o,(function(){return i[o]}))}(s);e["default"]=n.a},4724:function(o,e,t){},"5b14":function(o,e,t){"use strict";(function(o,e){var i=t("47a9");t("6d76");i(t("3240"));var n=i(t("ee87"));o.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},"707c":function(o,e,t){"use strict";t.d(e,"b",(function(){return n})),t.d(e,"c",(function(){return s})),t.d(e,"a",(function(){return i}));var i={uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,"e907"))},uPopup:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-popup/u-popup")]).then(t.bind(null,"b157"))},uEmpty:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-empty/u-empty")]).then(t.bind(null,"1724"))}},n=function(){var o=this,e=o.$createElement,i=(o._self._c,o.shopInfo.id&&"N"===o.shopInfo.is_collection?t("65c1"):null),n=o.shopInfo.id&&"N"!==o.shopInfo.is_collection?t("0df7"):null,s=o.shopInfo.id?o.__map(5,(function(e,t){var i=o.__get_orig(e),n=o.getStar(o.shopInfo.star,e+1);return{$orig:i,m2:n}})):null,r=o.shopInfo.id?o.shopInfo.store_images.length:null,u=o.shopInfo.id&&!r?o.shopInfo.brand_images.length:null,a=o.shopInfo.id?o.shopInfo.coupon_list.length:null,d=o.shopInfo.id&&a&&"a"===o.shopInfo.coupon_list[0].discount_type?o.shopInfo.coupon_list[0].top_price.replace(".00",""):null,h=o.shopInfo.id&&a&&"a"===o.shopInfo.coupon_list[0].discount_type?o.shopInfo.coupon_list[0].data.replace(".00",""):null,c=o.shopInfo.id&&a?o.shopInfo.coupon_list.length:null,p=o.shopInfo.id&&a&&c-1?o.shopInfo.coupon_list.length:null,l=o.shopInfo.id&&a&&c-1&&p>1?o.shopInfo.coupon_list.length:null,g=o.shopInfo.id?o.__map(o.rightList,(function(e,t){var i=o.__get_orig(e),n=o.__map(e.list,(function(t,i){var n=o.__get_orig(t),s="Y"!==t.is_group||e.is_buyed?null:t.group_list.length,r="Y"!==t.is_group||e.is_buyed||s?null:o.carIdList.findIndex((function(o){return o.id===t.id})),u="Y"!==t.is_group||e.is_buyed||s?null:o.carIdList.findIndex((function(o){return o.id===t.id})),a="Y"!==t.is_group||e.is_buyed||s||-1==u?null:o.carIdList.find((function(o){return o.id===t.id})),d=("Y"!==t.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed&&(i<3||o.is_zksq)?!t.group_list||!t.group_list.length:null,h=("Y"!==t.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed&&(i<3||o.is_zksq)&&d?o.carIdList.findIndex((function(o){return o.id===t.id})):null,c=("Y"!==t.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed&&(i<3||o.is_zksq)&&d?o.carIdList.findIndex((function(o){return o.id===t.id})):null,p=("Y"!==t.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed&&(i<3||o.is_zksq)&&d&&-1!=c?o.carIdList.find((function(o){return o.id===t.id})):null,l=("Y"!==t.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed?e.list.length:null,g=("Y"!==t.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed&&l>3?e.list.length:null,f="Y"===t.is_group&&!e.is_buyed||e.is_buyed&&"Y"===e.is_buyed?null:o.carIdList.findIndex((function(o){return o.id===t.id})),_="Y"===t.is_group&&!e.is_buyed||e.is_buyed&&"Y"===e.is_buyed?null:o.carIdList.findIndex((function(o){return o.id===t.id})),m="Y"===t.is_group&&!e.is_buyed||e.is_buyed&&"Y"===e.is_buyed||-1==_?null:o.carIdList.find((function(o){return o.id===t.id}));return{$orig:n,g8:s,g9:r,g10:u,g11:a,g12:d,g13:h,g14:c,g15:p,g16:l,g17:g,g18:f,g19:_,g20:m}}));return{$orig:i,l1:n}})):null,f=o.shopInfo.id?o.carIdList&&o.carIdList.length>0:null,_=o.shopInfo.id?o.goodsObj.group_list&&o.goodsObj.group_list.length:null,m=o.shopInfo.id?o.__map(o.goodsObj.group_list,(function(e,t){var i=o.__get_orig(e),n=e.goods_list?e.goods_list.length:null,s=e.goods_list.length;return{$orig:i,g23:n,g24:s}})):null,I=o.shopInfo.id?o.goodsObj.choice_des&&o.goodsObj.choice_des.length&&""!==o.goodsObj.choice_des[0]:null,b=o.shopInfo.id?o.goodsObj.images&&o.goodsObj.images.length:null,S=o.shopInfo.id&&b&&o.goodsObj.images?o.goodsObj.images.length:null,y=o.shopInfo.id?o.goodsObj.choice_des&&o.goodsObj.choice_des.length&&""!==o.goodsObj.choice_des[0]:null,w=o.shopInfo.id?!o.shopCarList||0===o.shopCarList.length:null,v=o.shopInfo.id?!o.shopCarList||0===o.shopCarList.length:null,L=o.shopInfo.id&&o.menuDetail.group_goods?o.menuDetail.group_goods.length:null,k=o.shopInfo.id?o.__map(o.shopInfo.coupon_list,(function(e,t){var i=o.__get_orig(e),n="a"===e.discount_type?e.top_price.replace(".00",""):null,s="a"===e.discount_type?e.data.replace(".00",""):null;return{$orig:i,g32:n,g33:s}})):null,C=o.shopInfo.id?o.__map(o.groupDetail.group_list,(function(e,t){var i=o.__get_orig(e),n="check"===e.type?e.goods_list.length||0:null,s="check"===e.type?o.__map(e.goods_list,(function(e,t){var i=o.__get_orig(e),n=o.groupGoodsId.includes(e.id);return{$orig:i,g35:n}})):null;return{$orig:i,g34:n,l5:s}})):null;o._isMounted||(o.e0=function(e){o.discountShow=!0},o.e1=function(e){o.is_zksq=!o.is_zksq},o.e2=function(e){o.menuShopShow=!1},o.e3=function(e){o.menuShopShow=!1},o.e4=function(e){o.shopShow=!1,o.goodsNum=1},o.e5=function(e){o.shopShow=!1,o.goodsNum=1},o.e6=function(e){o.shopCarShow=!1},o.e7=function(e){o.shopCarShow=!1},o.e8=function(e){o.menuDetailShow=!1,o.shopCarShow=!0},o.e9=function(e){o.menuDetailShow=!1,o.shopCarShow=!0},o.e10=function(e){o.discountShow=!1},o.e11=function(e){o.discountShow=!1},o.e12=function(e){o.peopleShow=!1},o.e13=function(e){o.peopleShow=!1},o.e14=function(e){o.remarkShow=!1,o.remarkIndex=null},o.e15=function(e){o.remarkShow=!1,o.remarkIndex=null},o.e16=function(e){o.groupDetailShow=!1},o.e17=function(e){o.groupDetailShow=!1}),o.$mp.data=Object.assign({},{$root:{m0:i,m1:n,l0:s,g0:r,g1:u,g2:a,g3:d,g4:h,g5:c,g6:p,g7:l,l2:g,g21:f,g22:_,l3:m,g25:I,g26:b,g27:S,g28:y,g29:w,g30:v,g31:L,l4:k,l6:C}})},s=[]},ce23:function(o,e,t){"use strict";(function(o){var i=t("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(t("7eb4")),s=i(t("ee10")),r={data:function(){return{appInfo:{logo:t("7cba"),appName:"雪域慧生活"},recommendList:[],shopInfo:{},type:0,leftList:[],rightList:[],currentIndex:0,rightInto:"",leftInto:"",topList:[],discountShow:!1,shopCarList:[],changeFlag:!1,shopShow:!1,menuShopShow:!1,shopCarShow:!1,goodsNum:1,goodsObj:{},menuDetail:{},menuDetailShow:!1,moneyObj:{},addType:!1,scanType:!1,workerType:!1,scanInfo:{},useCoupon:!1,orderId:"",status:{a:"平台通用",b:"品牌通用",c:"门店通用",d:"分类通用",e:"菜品限定",f:"套餐限定"},shopNumber:0,carIdList:[],peopleShow:!1,person_number:1,loginShow:!1,remarkIndex:null,remarkShow:!1,remarkObj:{},remarkType:null,remarkFlag:!0,groupDetailShow:!1,groupDetail:{},groupContain:[],groupGoods:[],groupGoodsId:[],is_zksq:!1,option:{},jwdxx:""}},onLoad:function(e){var t=this;return(0,s.default)(n.default.mark((function i(){var r,u,a,d,h;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(t.option=e,console.log("1店铺详情传参",e),!e.scene){i.next=13;break}for(r=e.scene,u=r.split("?")[1],a={},d=u.split("&"),h=0;h<d.length;h++)a[d[h].split("=")[0]]=d[h].split("=")[1];return console.log("???",a),i.next=11,t.$request("/food/Seat/miniCodeMsg",{id:a.id});case 11:e=i.sent,console.log("option.scene下面的option",e);case 13:o.getStorageSync("scanInfo")&&!e.id&&(e.id=o.getStorageSync("scanInfo").store_id,t.scanInfo=o.getStorageSync("scanInfo"),t.scanType=!0,o.removeStorageSync("scanInfo")),"scan"===e.type&&(console.log("扫码进入",e),e.id=e.store_id,t.scanInfo={seat_code:decodeURIComponent(e.seat_code).split("#")[0],seat_id:e.seat_id},t.scanType=!0),"workerOrder"===e.type&&(t.workerType=!0),"add"===e.type&&(t.addType=!0,t.useCoupon=e.useCoupon,t.orderId=e.orderId),o.getLocation({type:"wgs84",success:function(){var e=(0,s.default)(n.default.mark((function e(i){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.jwdxx=i.longitude+","+i.latitude,o.setStorageSync("mr_location",t.jwdxx),t._getStoreDetail();case 3:case"end":return e.stop()}}),e)})));return function(o){return e.apply(this,arguments)}}()}),setTimeout((function(){t.jwdxx.length>0||(t.jwdxx=o.getStorageSync("mr_location")?o.getStorageSync("mr_location"):"",t._getStoreDetail())}),3e3),o.showLoading({title:"请稍后"}),t.$request("/food/Goods/getGoodsList",{store_id:e.id}).then((function(e){t.leftList=e.list.map((function(o){return{id:o.id,icon:o.icon,name:o.name}})),t.recommendList=e.top_goods_list,t.rightList=e.list,setTimeout((function(){o.hideLoading();var e=o.createSelectorQuery();e.selectAll(".goodsClass").boundingClientRect((function(o){o&&o.map((function(o,e){var i=e>0?t.topList[e-1]:0;i+=o.height,t.topList.push(i)}))})).exec()}),1e3)}));case 21:case"end":return i.stop()}}),i)})))()},onShow:function(){var e=this;this.shopCarList=o.getStorageSync("shop"+this.shopInfo.id),this.carIdList=[],this.shopCarList&&(this.shopCarList.map((function(o){e.carIdList.push({id:o.info.id,number:o.num})})),this.changePrice());var t=this;setTimeout((function(){t.orderTo()}),2e3)},methods:{_getStoreDetail:function(){var e=this;return(0,s.default)(n.default.mark((function t(){return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$request("/food/Store/getStoreDetail",{location:e.jwdxx,store_id:e.option.id});case 2:e.shopInfo=t.sent,e.shopCarList=o.getStorageSync("shop"+e.shopInfo.id),e.shopCarList&&(e.shopCarList.map((function(o){e.carIdList.push({id:o.info.id,number:o.num})})),e.changePrice()),o.setStorageSync("mr_location",e.shopInfo.location),console.log("this.shopInfo",e.shopInfo),console.log("this.shopCarList",e.shopCarList);case 8:case"end":return t.stop()}}),t)})))()},orderTo:function(){var o=this;if(this.addType)return!1;console.log("当前餐位信息",this.scanInfo),this.$request("/food/Order/userGetOrderDetailByTableID",{table_id:this.scanInfo.seat_id}).then((function(e){console.log("当前座位是否有订单号",e),e.order_id&&o.$nav("/order_packages/detail/index",{id:e.order_id,time_status:"",pay_status:""})}))},login:function(){var e=this;return(0,s.default)(n.default.mark((function t(){var i,s,r,u,a,d;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o.showLoading({title:"请稍后"}),t.next=3,o.login();case 3:return i=t.sent,s=i.code,t.next=7,e.$request("/factory_system/Base/wechatUserRegister",{code:s,platform:"mini"});case 7:return r=t.sent,u=r.mini_openid,o.setStorageSync("openId",u),t.next=12,e.$request("/food/User/loginAndRegister",{openid:u});case 12:a=t.sent,d=a.token,o.setStorageSync("token",d),o.hideLoading(),e.loginShow=!1;case 17:case"end":return t.stop()}}),t)})))()},changeRemark:function(o){this.remarkIndex=o},changePeopleNum:function(o){this.person_number=o+1},peopleConfirm:function(){o.setStorageSync("person_number",{timestamp:(new Date).getTime(),person_number:this.person_number}),this.peopleShow=!1},changePrice:function(){var o=this;this.shopNumber=0;var e={goods_list:[]};this.shopCarList.length?(e.goods_list=this.shopCarList.map((function(e){return o.shopNumber+=e.num,{goods_type:1===e.type?"b":"a",goods_id:e.info.id,number:e.num}})),this.$request("/food/Order/computerGoods",e).then((function(e){o.moneyObj=e}))):(this.moneyObj={},this.carIdList=[])},changeCurrent:function(o,e){this.currentIndex=e,this.leftInto="r"+o,this.rightInto="l"+o,this.changeFlag=!0},collect:function(){var o=this;return(0,s.default)(n.default.mark((function e(){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o.shopInfo.is_collection="N"===o.shopInfo.is_collection?"Y":"N",e.next=3,o.$request("/food/Store/collectionStore",{store_id:o.shopInfo.id});case 3:case"end":return e.stop()}}),e)})))()},getStar:function(o,e){if(e-1>o)return"0%";if(Math.floor(o)>=e)return"100%";var t=o+"",i=t.split(".")[1];return 1===i.length&&(i*=10),i+"%"},openMap:function(){o.openLocation({longitude:Number(this.shopInfo.location.split(",")[0]),latitude:Number(this.shopInfo.location.split(",")[1]),name:this.shopInfo.name})},callPhone:function(e){o.makePhoneCall({phoneNumber:e})},rightScroll:function(o){if(!this.changeFlag){var e=o.target.scrollTop,t=this.topList.findIndex((function(o,t){return e<=o}));this.currentIndex=t}this.changeFlag=!1},openCar:function(){this.shopCarShow=!0,this.shopCarList=o.getStorageSync("shop"+this.shopInfo.id),this.changePrice()},menuShopping:function(o){this.goodsObj=o,this.menuShopShow=!0},getCoupon:function(e){var t=this;"Y"!==e.has_status&&this.$request("/food/Coupon/hasCoupon",{coupon_id:e.id}).then((function(e){o.getLocation({type:"wgs84",success:function(){var o=(0,s.default)(n.default.mark((function o(e){return n.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,t.$request("/food/Store/getStoreDetail",{location:e.longitude+","+e.latitude,store_id:t.shopInfo.id});case 2:t.shopInfo=o.sent;case 3:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}()})}))},openShopping:function(o){"Y"!==o.is_group?(this.goodsObj=o,this.shopShow=!0):this.selGroup(o)},changeNum:function(o){if("add"===o)this.goodsNum+=1;else if("min"===o){if(1===this.goodsNum)return;this.goodsNum-=1}},previewImg:function(e){o.previewImage({urls:[e]})},addShopCar:function(e){var t=this;console.log("goodsObj",this.goodsObj,e);var i=o.getStorageSync("shop"+this.shopInfo.id),n=!0;i?(i.map((function(o){o.info.id===t.goodsObj.id&&(o.num+=t.goodsNum,o.choice_des=t.goodsObj.choice_des[t.remarkIndex]||"",n=!1)})),n&&i.push({num:this.goodsNum,type:e,choice_des:this.goodsObj.choice_des[this.remarkIndex]||"",info:this.goodsObj}),this.shopCarList=i,o.setStorageSync("shop"+this.shopInfo.id,i)):(i=[{num:this.goodsNum,type:e,choice_des:this.goodsObj.choice_des[this.remarkIndex]||"",info:this.goodsObj}],this.shopCarList=i,o.setStorageSync("shop"+this.shopInfo.id,i)),this.carIdList=[],this.shopCarList.map((function(o){t.carIdList.push({id:o.info.id,number:o.num})})),this.remarkIndex=null,this.changePrice(),this.shopShow=!1,this.menuShopShow=!1,this.goodsNum=1},showDetail:function(o){console.log(o),this.menuDetail=o,this.shopCarShow=!1,this.menuDetailShow=!0},changeCarNum:function(e,t,i){var n=this;"add"===t?e.num+=1:"min"===t&&(1===e.num?(this.remarkFlag=!0,this.shopCarList.splice(i,1)):e.num-=1),o.setStorageSync("shop"+this.shopInfo.id,this.shopCarList),this.carIdList=[],this.shopCarList&&(this.shopCarList.map((function(o){n.carIdList.push({id:o.info.id,number:o.num})})),this.changePrice())},scanTableCode:function(){if(!o.getStorageSync("token"))return this.loginShow=!0,!1;this.shopCarList=o.getStorageSync("shop"+this.shopInfo.id),this.shopCarList&&0!==this.shopCarList.length?(this.addType?this.$nav("/home_packages/place_order/index",{id:this.shopInfo.id,addType:!0,useCoupon:this.useCoupon,orderId:this.orderId,canwei:this.option.canwei,pay_time:this.shopInfo.pay_time,rk:"shopping"}):this.scanType?this.$nav("/home_packages/place_order/index",{id:this.shopInfo.id,scanType:!0,table_code:this.scanInfo.seat_code,seat_id:this.scanInfo.seat_id,pay_time:this.shopInfo.pay_time,rk:"shopping"}):this.workerType?this.$nav("/home_packages/place_order/index",{id:this.shopInfo.id,workerType:!0,table_code:"",seat_id:"",help_user_coupon:this.option.help_user_coupon?this.option.help_user_coupon:"",help_user_order:this.option.help_user_order?this.option.help_user_order:"",help_user_platform:this.option.help_user_platform?this.option.help_user_platform:"",pay_time:this.shopInfo.pay_time,rk:"shopping"}):this.$nav("/home_packages/place_order/index",{id:this.shopInfo.id,scanType:!1,table_code:"",seat_id:"",pay_time:this.shopInfo.pay_time,rk:"shopping"}),this.shopCarShow=!1):o.showToast({title:"购物车为空",icon:"error"})},selGroup:function(o){var e=this;this.groupDetailShow=!0,this.groupDetail=o,this.groupContain=[],this.groupGoodsId=[],this.groupGoods=[],o.group_list.map((function(o){"single"===o.type&&(e.groupContain=e.groupContain.concat(o.goods_list))}))},addCar:function(e,t,i){var n=this,s=this.carIdList.findIndex((function(o){return o.id===t.id}));if(this.remarkObj.id!==t.id&&(this.remarkFlag=!0),-1===s||t.group_goods){if(t.group_goods&&(this.remarkFlag=!0),null===this.remarkIndex&&t.choice_des.length&&""!==t.choice_des[0]&&this.remarkFlag)return this.remarkObj=t,this.remarkType=e,void(this.remarkShow=!0);this.remarkShow&&(this.remarkFlag=!1,this.remarkShow=!1),this.carIdList.push({id:t.id,number:1})}else"add"===i?this.carIdList[s].number+=1:"min"===i&&(this.carIdList[s].number-=1,0===this.carIdList[s].number&&(this.remarkFlag=!0,this.carIdList.splice(s,1)));var r=o.getStorageSync("shop"+this.shopInfo.id),u=!0,a=null;r?(t.group_goods&&t.group_goods.length||r.map((function(o,e){o.info.id===t.id&&(n.carIdList[e]&&n.carIdList[e].id===t.id?o.num=n.carIdList[e].number:a=e,u=!1)})),(a||0===a)&&r.splice(a,1),u&&r.push({num:1,type:e,choice_des:t.choice_des[this.remarkIndex]||"",info:t}),this.shopCarList=r,o.setStorageSync("shop"+this.shopInfo.id,r)):(r=[{num:this.goodsNum,type:e,choice_des:t.choice_des[this.remarkIndex]||"",info:t}],this.shopCarList=r,o.setStorageSync("shop"+this.shopInfo.id,r)),this.remarkIndex=null,this.changePrice()},selectGood:function(e,t,i){var n=this.groupGoods.findIndex((function(o){return o.goods_id===t.id}));if(-1!==n)return this.groupGoods.splice(n,1),void this.groupGoodsId.splice(n,1);var s=this.groupGoods.findIndex((function(o){return o.parent_id===e}));if(-1!==s)if(1===Number(i))this.groupGoods.splice(s,1,{goods_id:t.id,has_number:t.has_number,parent_id:e,name:t.name,cover_image:t.cover_image}),this.groupGoodsId.splice(s,1,t.id);else{var r=this.groupGoods.filter((function(o){return o.parent_id===e})).length;r<i?(this.groupGoods.push({goods_id:t.id,has_number:t.has_number,parent_id:e,name:t.name,cover_image:t.cover_image}),this.groupGoodsId.push(t.id)):o.showToast({title:"最多选择 ".concat(i," 个"),icon:"none"})}else this.groupGoods.push({goods_id:t.id,has_number:t.has_number,parent_id:e,name:t.name,cover_image:t.cover_image}),this.groupGoodsId.push(t.id)},groupAddCar:function(){var e=this,t=0;if(this.groupDetail.group_list.map((function(o){"check"==o.type&&(t+=Number(o.check_number))})),this.groupGoods.length<t)return o.showToast({title:"请选择商品",icon:"error"}),!1;this.groupContain.map((function(o){e.groupGoods.push({goods_id:o.id,has_number:o.has_number,name:o.name,cover_image:o.cover_image})})),this.groupDetail.group_goods=JSON.parse(JSON.stringify(this.groupGoods)),this.groupGoodsId=[],this.groupGoods=[],this.groupDetailShow=!1,this.addCar(1,this.groupDetail,"add")}}};e.default=r}).call(this,t("df3c")["default"])},e8ba:function(o,e,t){"use strict";var i=t("4724"),n=t.n(i);n.a},ee87:function(o,e,t){"use strict";t.r(e);var i=t("707c"),n=t("191e");for(var s in n)["default"].indexOf(s)<0&&function(o){t.d(e,o,(function(){return n[o]}))}(s);t("e8ba");var r=t("828b"),u=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);e["default"]=u.exports}},[["5b14","common/runtime","common/vendor"]]]);