(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["home_packages/shop_detail/index"],{"1a56":function(o,e,n){"use strict";(function(o,e){var i=n("47a9");n("5e4b");i(n("3240"));var t=i(n("96b4"));o.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},"6a70":function(o,e,n){},"90e5":function(o,e,n){"use strict";n.d(e,"b",(function(){return t})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}));var i={uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,"2b07"))},uPopup:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-popup/u-popup")]).then(n.bind(null,"829e"))},uEmpty:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-empty/u-empty")]).then(n.bind(null,"c813"))}},t=function(){var o=this,e=o.$createElement,i=(o._self._c,o.shopInfo.id&&"N"===o.shopInfo.is_collection?n("d7be"):null),t=o.shopInfo.id&&"N"!==o.shopInfo.is_collection?n("f4ce"):null,s=o.shopInfo.id?o.__map(5,(function(e,n){var i=o.__get_orig(e),t=o.getStar(o.shopInfo.star,e+1);return{$orig:i,m2:t}})):null,r=o.shopInfo.id?o.shopInfo.store_images.length:null,u=o.shopInfo.id&&!r?o.shopInfo.brand_images.length:null,d=o.shopInfo.id?o.shopInfo.coupon_list.length:null,a=o.shopInfo.id&&d&&"a"===o.shopInfo.coupon_list[0].discount_type?o.shopInfo.coupon_list[0].top_price.replace(".00",""):null,h=o.shopInfo.id&&d&&"a"===o.shopInfo.coupon_list[0].discount_type?o.shopInfo.coupon_list[0].data.replace(".00",""):null,p=o.shopInfo.id&&d?o.shopInfo.coupon_list.length:null,c=o.shopInfo.id&&d&&p-1?o.shopInfo.coupon_list.length:null,l=o.shopInfo.id&&d&&p-1&&c>1?o.shopInfo.coupon_list.length:null,g=o.shopInfo.id?o.recommendList.length:null,f=o.shopInfo.id?o.__map(o.recommendList,(function(e,n){var i=o.__get_orig(e),t=!e.group_list||!e.group_list.length,s=t?o.carIdList.findIndex((function(o){return o.id===e.id})):null,r=t?o.carIdList.findIndex((function(o){return o.id===e.id})):null,u=t&&-1!=r?o.carIdList.find((function(o){return o.id===e.id})):null;return{$orig:i,g9:t,g10:s,g11:r,g12:u}})):null,_=o.shopInfo.id?o.__map(o.rightList,(function(e,n){var i=o.__get_orig(e),t=o.__map(e.list,(function(n,i){var t=o.__get_orig(n),s="Y"!==n.is_group||e.is_buyed?null:n.group_list.length,r="Y"!==n.is_group||e.is_buyed||s?null:o.carIdList.findIndex((function(o){return o.id===n.id})),u="Y"!==n.is_group||e.is_buyed||s?null:o.carIdList.findIndex((function(o){return o.id===n.id})),d="Y"!==n.is_group||e.is_buyed||s||-1==u?null:o.carIdList.find((function(o){return o.id===n.id})),a=("Y"!==n.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed&&(i<3||o.is_zksq)?!n.group_list||!n.group_list.length:null,h=("Y"!==n.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed&&(i<3||o.is_zksq)&&a?o.carIdList.findIndex((function(o){return o.id===n.id})):null,p=("Y"!==n.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed&&(i<3||o.is_zksq)&&a?o.carIdList.findIndex((function(o){return o.id===n.id})):null,c=("Y"!==n.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed&&(i<3||o.is_zksq)&&a&&-1!=p?o.carIdList.find((function(o){return o.id===n.id})):null,l=("Y"!==n.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed?e.list.length:null,g=("Y"!==n.is_group||e.is_buyed)&&e.is_buyed&&"Y"===e.is_buyed&&l>3?e.list.length:null,f="Y"===n.is_group&&!e.is_buyed||e.is_buyed&&"Y"===e.is_buyed?null:o.carIdList.findIndex((function(o){return o.id===n.id})),_="Y"===n.is_group&&!e.is_buyed||e.is_buyed&&"Y"===e.is_buyed?null:o.carIdList.findIndex((function(o){return o.id===n.id})),m="Y"===n.is_group&&!e.is_buyed||e.is_buyed&&"Y"===e.is_buyed||-1==_?null:o.carIdList.find((function(o){return o.id===n.id}));return{$orig:t,g13:s,g14:r,g15:u,g16:d,g17:a,g18:h,g19:p,g20:c,g21:l,g22:g,g23:f,g24:_,g25:m}}));return{$orig:i,l2:t}})):null,m=o.shopInfo.id?o.carIdList&&o.carIdList.length>0:null,I=o.shopInfo.id?o.goodsObj.group_list&&o.goodsObj.group_list.length:null,b=o.shopInfo.id?o.__map(o.goodsObj.group_list,(function(e,n){var i=o.__get_orig(e),t=e.goods_list?e.goods_list.length:null,s=e.goods_list.length;return{$orig:i,g28:t,g29:s}})):null,S=o.shopInfo.id?o.goodsObj.choice_des&&o.goodsObj.choice_des.length&&""!==o.goodsObj.choice_des[0]:null,y=o.shopInfo.id?o.goodsObj.images&&o.goodsObj.images.length:null,w=o.shopInfo.id&&y&&o.goodsObj.images?o.goodsObj.images.length:null,L=o.shopInfo.id?o.goodsObj.choice_des&&o.goodsObj.choice_des.length&&""!==o.goodsObj.choice_des[0]:null,v=o.shopInfo.id?!o.shopCarList||0===o.shopCarList.length:null,k=o.shopInfo.id?!o.shopCarList||0===o.shopCarList.length:null,C=o.shopInfo.id&&o.menuDetail.group_goods?o.menuDetail.group_goods.length:null,x=o.shopInfo.id?o.__map(o.shopInfo.coupon_list,(function(e,n){var i=o.__get_orig(e),t="a"===e.discount_type?e.top_price.replace(".00",""):null,s="a"===e.discount_type?e.data.replace(".00",""):null;return{$orig:i,g37:t,g38:s}})):null,O=o.shopInfo.id?o.__map(o.groupDetail.group_list,(function(e,n){var i=o.__get_orig(e),t="check"===e.type?e.goods_list.length||0:null,s="check"===e.type?o.__map(e.goods_list,(function(e,n){var i=o.__get_orig(e),t=o.groupGoodsId.includes(e.id);return{$orig:i,g40:t}})):null;return{$orig:i,g39:t,l6:s}})):null;o._isMounted||(o.e0=function(e){o.discountShow=!0},o.e1=function(e){o.is_zksq=!o.is_zksq},o.e2=function(e){o.menuShopShow=!1},o.e3=function(e){o.menuShopShow=!1},o.e4=function(e){o.shopShow=!1,o.goodsNum=1},o.e5=function(e){o.shopShow=!1,o.goodsNum=1},o.e6=function(e){o.shopCarShow=!1},o.e7=function(e){o.shopCarShow=!1},o.e8=function(e){o.menuDetailShow=!1,o.shopCarShow=!0},o.e9=function(e){o.menuDetailShow=!1,o.shopCarShow=!0},o.e10=function(e){o.discountShow=!1},o.e11=function(e){o.discountShow=!1},o.e12=function(e){o.peopleShow=!1},o.e13=function(e){o.peopleShow=!1},o.e14=function(e){o.remarkShow=!1,o.remarkIndex=null},o.e15=function(e){o.remarkShow=!1,o.remarkIndex=null},o.e16=function(e){o.groupDetailShow=!1},o.e17=function(e){o.groupDetailShow=!1}),o.$mp.data=Object.assign({},{$root:{m0:i,m1:t,l0:s,g0:r,g1:u,g2:d,g3:a,g4:h,g5:p,g6:c,g7:l,g8:g,l1:f,l3:_,g26:m,g27:I,l4:b,g30:S,g31:y,g32:w,g33:L,g34:v,g35:k,g36:C,l5:x,l7:O}})},s=[]},"96b4":function(o,e,n){"use strict";n.r(e);var i=n("90e5"),t=n("d384");for(var s in t)["default"].indexOf(s)<0&&function(o){n.d(e,o,(function(){return t[o]}))}(s);n("a57a");var r=n("828b"),u=Object(r["a"])(t["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);e["default"]=u.exports},a417:function(o,e,n){"use strict";(function(o){var i=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=i(n("7eb4")),s=i(n("ee10")),r={data:function(){return{appInfo:{logo:n("8b71"),appName:"雪域慧生活"},recommendList:[],shopInfo:{},type:0,leftList:[],rightList:[],currentIndex:0,rightInto:"",leftInto:"",topList:[],discountShow:!1,shopCarList:[],changeFlag:!1,shopShow:!1,menuShopShow:!1,shopCarShow:!1,goodsNum:1,goodsObj:{},menuDetail:{},menuDetailShow:!1,moneyObj:{},addType:!1,scanType:!1,workerType:!1,scanInfo:{},useCoupon:!1,orderId:"",status:{a:"平台通用",b:"品牌通用",c:"门店通用",d:"分类通用",e:"菜品限定",f:"套餐限定"},shopNumber:0,carIdList:[],peopleShow:!1,person_number:1,loginShow:!1,remarkIndex:null,remarkShow:!1,remarkObj:{},remarkType:null,remarkFlag:!0,groupDetailShow:!1,groupDetail:{},groupContain:[],groupGoods:[],groupGoodsId:[],is_zksq:!1,option:{}}},onLoad:function(e){var n=this;return(0,s.default)(t.default.mark((function i(){var r,u,d,a,h,p;return t.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n.option=e,o.getStorageSync("token")||(n.loginShow=!0),console.log(e),!e.scene){i.next=18;break}for(r=decodeURIComponent(e.scene),u=r.split("?")[1],d={},a=u.split("&"),h=0;h<a.length;h++)d[a[h].split("=")[0]]=a[h].split("=")[1];return i.next=11,n.$request("/food/Seat/miniCodeMsg",{id:d.id});case 11:return e=i.sent,console.log("option",e),i.next=15,n.$request("/food/Order/userGetOrderDetailByTableID",{table_id:e.seat_id});case 15:p=i.sent,console.log("resule",p),p.order_id&&n.$nav("/order_packages/detail/index",{id:p.order_id,time_status:"",pay_status:""});case 18:o.getStorageSync("scanInfo")&&!e.id&&(e.id=o.getStorageSync("scanInfo").store_id,n.scanInfo=o.getStorageSync("scanInfo"),n.scanType=!0,o.removeStorageSync("scanInfo")),"scan"===e.type&&(e.id=e.store_id,n.scanInfo={seat_code:decodeURIComponent(e.seat_code.split("#")[0]),seat_id:e.seat_id},n.scanType=!0),"workerOrder"===e.type&&(n.workerType=!0),"add"===e.type&&(n.addType=!0,n.useCoupon=e.useCoupon,n.orderId=e.orderId),o.getLocation({type:"wgs84",success:function(){var i=(0,s.default)(t.default.mark((function i(s){return t.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,n.$request("/food/Store/getStoreDetail",{location:s.longitude+","+s.latitude,store_id:e.id});case 2:n.shopInfo=i.sent,n.shopCarList=o.getStorageSync("shop"+n.shopInfo.id),n.shopCarList&&(n.shopCarList.map((function(o){n.carIdList.push({id:o.info.id,number:o.num})})),n.changePrice());case 5:case"end":return i.stop()}}),i)})));return function(o){return i.apply(this,arguments)}}()}),o.showLoading({title:"请稍后"}),n.$request("/food/Goods/getGoodsList",{store_id:e.id}).then((function(e){n.leftList=e.list.map((function(o){return{id:o.id,icon:o.icon,name:o.name}})),n.recommendList=e.top_goods_list,n.rightList=e.list,setTimeout((function(){o.hideLoading();var e=o.createSelectorQuery();e.selectAll(".goodsClass").boundingClientRect((function(o){o&&o.map((function(o,e){var i=e>0?n.topList[e-1]:0;i+=o.height,n.topList.push(i)}))})).exec()}),1e3)}));case 25:case"end":return i.stop()}}),i)})))()},onShow:function(){var e=this;this.shopCarList=o.getStorageSync("shop"+this.shopInfo.id),this.carIdList=[],this.shopCarList&&(this.shopCarList.map((function(o){e.carIdList.push({id:o.info.id,number:o.num})})),this.changePrice())},methods:{login:function(){var e=this;return(0,s.default)(t.default.mark((function n(){var i,s,r,u,d,a;return t.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o.showLoading({title:"请稍后"}),n.next=3,o.login();case 3:return i=n.sent,s=i.code,n.next=7,e.$request("/factory_system/Base/wechatUserRegister",{code:s,platform:"mini"});case 7:return r=n.sent,u=r.mini_openid,o.setStorageSync("openId",u),n.next=12,e.$request("/food/User/loginAndRegister",{openid:u});case 12:d=n.sent,a=d.token,o.setStorageSync("token",a),o.hideLoading(),e.loginShow=!1;case 17:case"end":return n.stop()}}),n)})))()},changeRemark:function(o){this.remarkIndex=o},changePeopleNum:function(o){this.person_number=o+1},peopleConfirm:function(){o.setStorageSync("person_number",{timestamp:(new Date).getTime(),person_number:this.person_number}),this.peopleShow=!1},changePrice:function(){var o=this;this.shopNumber=0;var e={goods_list:[]};this.shopCarList.length?(e.goods_list=this.shopCarList.map((function(e){return o.shopNumber+=e.num,{goods_type:1===e.type?"b":"a",goods_id:e.info.id,number:e.num}})),this.$request("/food/Order/computerGoods",e).then((function(e){o.moneyObj=e}))):(this.moneyObj={},this.carIdList=[])},changeCurrent:function(o,e){this.currentIndex=e,this.leftInto="r"+o,this.rightInto="l"+o,this.changeFlag=!0},collect:function(){var o=this;return(0,s.default)(t.default.mark((function e(){return t.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o.shopInfo.is_collection="N"===o.shopInfo.is_collection?"Y":"N",e.next=3,o.$request("/food/Store/collectionStore",{store_id:o.shopInfo.id});case 3:case"end":return e.stop()}}),e)})))()},getStar:function(o,e){if(e-1>o)return"0%";if(Math.floor(o)>=e)return"100%";var n=o+"",i=n.split(".")[1];return 1===i.length&&(i*=10),i+"%"},openMap:function(){o.openLocation({longitude:Number(this.shopInfo.location.split(",")[0]),latitude:Number(this.shopInfo.location.split(",")[1]),name:this.shopInfo.name})},callPhone:function(e){o.makePhoneCall({phoneNumber:e})},rightScroll:function(o){if(!this.changeFlag){var e=o.target.scrollTop,n=this.topList.findIndex((function(o,n){return e<=o}));this.currentIndex=n}this.changeFlag=!1},openCar:function(){this.shopCarShow=!0,this.shopCarList=o.getStorageSync("shop"+this.shopInfo.id),this.changePrice()},menuShopping:function(o){this.goodsObj=o,this.menuShopShow=!0},getCoupon:function(e){var n=this;"Y"!==e.has_status&&this.$request("/food/Coupon/hasCoupon",{coupon_id:e.id}).then((function(e){o.getLocation({type:"wgs84",success:function(){var o=(0,s.default)(t.default.mark((function o(e){return t.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,n.$request("/food/Store/getStoreDetail",{location:e.longitude+","+e.latitude,store_id:n.shopInfo.id});case 2:n.shopInfo=o.sent;case 3:case"end":return o.stop()}}),o)})));return function(e){return o.apply(this,arguments)}}()})}))},openShopping:function(o){"Y"!==o.is_group?(this.goodsObj=o,this.shopShow=!0):this.selGroup(o)},changeNum:function(o){if("add"===o)this.goodsNum+=1;else if("min"===o){if(1===this.goodsNum)return;this.goodsNum-=1}},previewImg:function(e){o.previewImage({urls:[e]})},addShopCar:function(e){var n=this;console.log("goodsObj",this.goodsObj,e);var i=o.getStorageSync("shop"+this.shopInfo.id),t=!0;i?(i.map((function(o){o.info.id===n.goodsObj.id&&(o.num+=n.goodsNum,o.choice_des=n.goodsObj.choice_des[n.remarkIndex]||"",t=!1)})),t&&i.push({num:this.goodsNum,type:e,choice_des:this.goodsObj.choice_des[this.remarkIndex]||"",info:this.goodsObj}),this.shopCarList=i,o.setStorageSync("shop"+this.shopInfo.id,i)):(i=[{num:this.goodsNum,type:e,choice_des:this.goodsObj.choice_des[this.remarkIndex]||"",info:this.goodsObj}],this.shopCarList=i,o.setStorageSync("shop"+this.shopInfo.id,i)),this.carIdList=[],this.shopCarList.map((function(o){n.carIdList.push({id:o.info.id,number:o.num})})),this.remarkIndex=null,this.changePrice(),this.shopShow=!1,this.menuShopShow=!1,this.goodsNum=1},showDetail:function(o){console.log(o),this.menuDetail=o,this.shopCarShow=!1,this.menuDetailShow=!0},changeCarNum:function(e,n,i){var t=this;"add"===n?e.num+=1:"min"===n&&(1===e.num?(this.remarkFlag=!0,this.shopCarList.splice(i,1)):e.num-=1),o.setStorageSync("shop"+this.shopInfo.id,this.shopCarList),this.carIdList=[],this.shopCarList&&(this.shopCarList.map((function(o){t.carIdList.push({id:o.info.id,number:o.num})})),this.changePrice())},scanTableCode:function(){this.shopCarList=o.getStorageSync("shop"+this.shopInfo.id),this.shopCarList&&0!==this.shopCarList.length?(this.addType?this.$nav("/home_packages/place_order/index",{id:this.shopInfo.id,addType:!0,useCoupon:this.useCoupon,orderId:this.orderId,canwei:this.option.canwei}):this.scanType?this.$nav("/home_packages/place_order/index",{id:this.shopInfo.id,scanType:!0,table_code:this.scanInfo.seat_code,seat_id:this.scanInfo.seat_id}):this.workerType?this.$nav("/home_packages/place_order/index",{id:this.shopInfo.id,workerType:!0,table_code:"",seat_id:"",help_user_coupon:this.option.help_user_coupon?this.option.help_user_coupon:"",help_user_order:this.option.help_user_order?this.option.help_user_order:"",help_user_platform:this.option.help_user_platform?this.option.help_user_platform:""}):this.$nav("/home_packages/place_order/index",{id:this.shopInfo.id,scanType:!1,table_code:"",seat_id:""}),this.shopCarShow=!1):o.showToast({title:"购物车为空",icon:"error"})},selGroup:function(o){var e=this;this.groupDetailShow=!0,this.groupDetail=o,this.groupContain=[],this.groupGoodsId=[],this.groupGoods=[],o.group_list.map((function(o){"single"===o.type&&(e.groupContain=e.groupContain.concat(o.goods_list))}))},addCar:function(e,n,i){var t=this,s=this.carIdList.findIndex((function(o){return o.id===n.id}));if(this.remarkObj.id!==n.id&&(this.remarkFlag=!0),-1===s||n.group_goods){if(n.group_goods&&(this.remarkFlag=!0),null===this.remarkIndex&&n.choice_des.length&&""!==n.choice_des[0]&&this.remarkFlag)return this.remarkObj=n,this.remarkType=e,void(this.remarkShow=!0);this.remarkShow&&(this.remarkFlag=!1,this.remarkShow=!1),this.carIdList.push({id:n.id,number:1})}else"add"===i?this.carIdList[s].number+=1:"min"===i&&(this.carIdList[s].number-=1,0===this.carIdList[s].number&&(this.remarkFlag=!0,this.carIdList.splice(s,1)));var r=o.getStorageSync("shop"+this.shopInfo.id),u=!0,d=null;r?(n.group_goods&&n.group_goods.length||r.map((function(o,e){o.info.id===n.id&&(t.carIdList[e]&&t.carIdList[e].id===n.id?o.num=t.carIdList[e].number:d=e,u=!1)})),(d||0===d)&&r.splice(d,1),u&&r.push({num:1,type:e,choice_des:n.choice_des[this.remarkIndex]||"",info:n}),this.shopCarList=r,o.setStorageSync("shop"+this.shopInfo.id,r)):(r=[{num:this.goodsNum,type:e,choice_des:n.choice_des[this.remarkIndex]||"",info:n}],this.shopCarList=r,o.setStorageSync("shop"+this.shopInfo.id,r)),this.remarkIndex=null,this.changePrice()},selectGood:function(o,e,n){var i=this;if(!this.groupGoods.length)return this.groupGoods.push({goods_id:e.id,has_number:e.has_number,parent_id:o,name:e.name,cover_image:e.cover_image}),void this.groupGoodsId.push(e.id);var t=!1,s=0;this.groupGoodsId=[];var r=!1,u=null,d=null;this.groupGoods.map((function(n,i){n.goods_id===e.id&&(r=!0,u=i),n.parent_id===o&&s++})),this.groupGoods.map((function(o,e){r||(s>0?1===Number(n)?d=e:s<n&&(t=!0):t=!0),i.groupGoodsId.push(o.goods_id)})),null!==d&&(this.groupGoods[d]={goods_id:e.id,has_number:e.has_number,parent_id:o,name:e.name,cover_image:e.cover_image},this.groupGoodsId[d]=e.id),r&&(this.groupGoods.splice(u,1),this.groupGoodsId.splice(u,1)),t&&(this.groupGoodsId.push(e.id),this.groupGoods.push({goods_id:e.id,has_number:e.has_number,parent_id:o,name:e.name,cover_image:e.cover_image}))},groupAddCar:function(){var e=this,n=0;if(this.groupDetail.group_list.map((function(o){"check"==o.type&&(n+=Number(o.check_number))})),this.groupGoods.length<n)return o.showToast({title:"请选择商品",icon:"error"}),!1;this.groupContain.map((function(o){e.groupGoods.push({goods_id:o.id,has_number:o.has_number,name:o.name,cover_image:o.cover_image})})),this.groupDetail.group_goods=JSON.parse(JSON.stringify(this.groupGoods)),this.groupGoodsId=[],this.groupGoods=[],this.groupDetailShow=!1,this.addCar(1,this.groupDetail,"add")}}};e.default=r}).call(this,n("df3c")["default"])},a57a:function(o,e,n){"use strict";var i=n("6a70"),t=n.n(i);t.a},d384:function(o,e,n){"use strict";n.r(e);var i=n("a417"),t=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(o){n.d(e,o,(function(){return i[o]}))}(s);e["default"]=t.a}},[["1a56","common/runtime","common/vendor"]]]);