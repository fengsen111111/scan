(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["home_packages/place_order/index"],{"58b8":function(e,o,t){"use strict";var r=t("d738"),n=t.n(r);n.a},"5f00":function(e,o,t){"use strict";t.r(o);var r=t("e058"),n=t.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){t.d(o,e,(function(){return r[e]}))}(i);o["default"]=n.a},7873:function(e,o,t){"use strict";t.r(o);var r=t("ccac"),n=t("5f00");for(var i in n)["default"].indexOf(i)<0&&function(e){t.d(o,e,(function(){return n[e]}))}(i);t("58b8");var s=t("828b"),c=Object(s["a"])(n["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],void 0);o["default"]=c.exports},"847f":function(e,o,t){"use strict";(function(e,o){var r=t("47a9");t("bcba");r(t("3240"));var n=r(t("7873"));e.__webpack_require_UNI_MP_PLUGIN__=t,o(n.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},ccac:function(e,o,t){"use strict";t.d(o,"b",(function(){return n})),t.d(o,"c",(function(){return i})),t.d(o,"a",(function(){return r}));var r={uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,"8297"))},uPopup:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-popup/u-popup")]).then(t.bind(null,"2d96"))},uCheckboxGroup:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-checkbox-group/u-checkbox-group")]).then(t.bind(null,"027f"))},uCheckbox:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-checkbox/u-checkbox")]).then(t.bind(null,"aa3f"))},uEmpty:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-empty/u-empty")]).then(t.bind(null,"086b"))}},n=function(){var e=this,o=e.$createElement,t=(e._self._c,e.goodsList.length),r=!e.discountList||0===e.discountList.length,n=!e.discountList||0===e.discountList.length,i=e.__map(e.discountList,(function(o,t){var r=e.__get_orig(o),n="a"===o.discount_type?o.top_price.replace(".00",""):null,i="a"===o.discount_type?o.data.replace(".00",""):null;return{$orig:r,g3:n,g4:i}}));e._isMounted||(e.e0=function(o){e.payShow=!1},e.e1=function(o){e.payShow=!1},e.e2=function(o){e.tableShow=!1}),e.$mp.data=Object.assign({},{$root:{g0:t,g1:r,g2:n,l0:i}})},i=[]},d738:function(e,o,t){},e058:function(e,o,t){"use strict";(function(e,r){var n=t("47a9");Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=n(t("7ca3")),s=t("3a55");function c(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);o&&(r=r.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?c(Object(t),!0).forEach((function(o){(0,i.default)(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}var d={components:{cityPicker:function(){t.e("uni_modules/piaoyi-cityPicker/components/piaoyi-cityPicker/piaoyi-cityPicker").then(function(){return resolve(t("0b32"))}.bind(null,t)).catch(t.oe)}},data:function(){return{defaultValue:"",store_id:"",table_code:"",tableList:[],tableShow:!1,formData:{goods_list:[]},numberShow:!0,orderForm:{store_id:"",coupon_id:"",table_id:"",person_number:1,remark:"",goods_list:[],order_id:""},goodsList:[],discountShow:!1,discountFirst:!1,discountList:[],status:{a:"平台通用",b:"品牌通用",c:"门店通用",d:"分类通用",e:"菜品限定",f:"套餐限定"},moneyObj:{},confirmFlag:!0,addType:!1,useCoupon:!1,orderId:"",orderResult:!1,checkValue:[1],checkValue1:[],payShow:!1,payType:2,payFlag:!0,userMoney:0,workerType:!1,option:{},is_request_ok:!0,jwdxx:"",visOrderId:""}},onLoad:function(o){var t=this;console.log("options11",o),"shopping"==o.rk||(e.showToast({title:"请通过店铺详情进入",icon:"none",duration:2e3}),setTimeout((function(){e.navigateBack()}),1e3)),this.$request("/food/Seat/geSeatList2",{store_id:o.id}).then((function(e){if(t.tableList=e.list,o.seat_id){var r=e.list.filter((function(e){return e.id==o.seat_id}));console.log("obj",r),r.length>0&&(t.orderForm.table_id=r[0].id,t.table_code=r[0].code)}})),this.option=o,this.workerType=!0,o.addType&&(e.showLoading({title:"加载中...",mask:!0}),this.table_code=o.canwei,this.orderForm.order_id=o.orderId,console.log(o.useCoupon),setTimeout((function(){var r=t.tableList.filter((function(e){return e.code==o.canwei}));console.log("arr",r),t.orderForm.table_id=r[0].id,e.hideLoading()}),2e3),this.addType=!0,this.useCoupon="false"!==o.useCoupon,this.orderId=o.orderId),e.getStorageSync("person_number")&&(this.orderForm.person_number=e.getStorageSync("person_number").person_number,this.numberShow=!1),o.workerType&&(this.workerType=!0),this.goodsList=e.getStorageSync("shop"+o.id)||[],e.removeStorageSync("shop"+o.id),this.orderForm.store_id=o.id,this.store_id=o.id,this.changePayData(),this.selectCount("first")},onShow:function(){},methods:{clearShopDel:function(){return!1},discountClose:function(){this.discountShow=!1,1!==this.checkValue1[0]&&(this.checkValue=[])},scanCode:function(){var o=this;r.scanCode({success:function(t){for(var r=t.path.split("?")[1],n={},i=r.split("&"),s=0;s<i.length;s++)n[i[s].split("=")[0]]=i[s].split("=")[1];o.$request("/food/Seat/getScanMsg",{scan_id:n.scene}).then((function(t){o.orderForm.table_id=t.seat_id,o.table_code=t.seat_code,o.$request("/food/Order/userGetOrderDetailByTableID",{table_id:n.seat_id}).then((function(o){o.order_id&&e.switchTab({url:"/order_packages/detail/index?id="+o.order_id})}))}))}})},selectTable:function(){if(console.log("baseUrl",s.baseUrl),"https://test.api.xzddd.com"!=s.baseUrl)return!1;console.log("测试地址"),this.tableShow=!0},tableConfirm:function(e){var o=this.tableList[e];console.log("确定",o.code),o&&(this.orderForm.table_id=o.id,this.table_code=o.code),this.tableShow=!1},changePayData:function(){var e=this;this.goodsList.length?this.formData.goods_list=this.goodsList.map((function(e){return(0,i.default)({goods_type:1===e.type?"b":"a",goods_id:e.info.id,number:e.num,choice_des:e.choice_des},e.info.group_goods?"group_goods":"",e.info.group_goods)})):this.formData.goods_list=[],this.$request("/food/Order/computePayData",{goods_list:this.formData.goods_list,coupon_id:this.orderForm.coupon_id,pay_type:1===this.checkValue[0]?"b":"a"}).then((function(o){e.moneyObj=o}))},changePeopleNum:function(e){if("add"===e)this.orderForm.person_number+=1;else{if(1===this.orderForm.person_number)return;this.orderForm.person_number-=1}},trash:function(o){var t=this;e.showModal({title:"温馨提示",content:"确认删除吗？",success:function(r){r.confirm&&(t.goodsList.splice(o,1),e.setStorageSync("shop"+t.store_id,t.goodsList),t.changePayData())}})},changeCarNum:function(o,t,r){"add"===t?o.num+=1:"min"===t&&(1===o.num?this.goodsList.splice(r,1):o.num-=1),e.setStorageSync("shop"+this.store_id,this.goodsList),this.changePayData()},selectCount:function(e){var o=this,t=[];this.goodsList.length&&(t=this.goodsList.map((function(e){return(0,i.default)({goods_type:1===e.type?"b":"a",goods_id:e.info.id,number:e.num,choice_des:e.choice_des},e.group_goods?"group_goods":"",e.group_goods)}))),this.$request("/food/Coupon/getOrderCoupon",{store_id:this.store_id,goods_list:t}).then((function(t){o.discountList=t.list,o.workerType||(o.discountFirst="first"===e,"first"===e&&0===o.discountList.length?o.discountShow=!1:o.discountShow=!0)}))},changePayType:function(e){this.payType=e},getCoupon:function(e){var o=this;this.$request("/food/Coupon/hasCoupon",{coupon_id:e.id}).then((function(){o.selectCount()}))},useCouponEven:function(e){this.orderForm.coupon_id=e.id,this.discountShow=!1,this.changePayData()},checkboxChange:function(e){this.checkValue=e,this.changePayData()},zj_order:function(){var o=this;if(this.table_code&&this.orderForm.table_id)if(0!==this.goodsList.length){if(this.workerType){e.showLoading({title:"请稍后……",mask:!0});var t=a(a(a({},this.orderForm),this.formData),{},{location:""});this.option.help_user_order&&(t.help_user_order=this.option.help_user_order),this.option.help_user_coupon&&(t.help_user_coupon=this.option.help_user_coupon),this.option.help_user_platform&&(t.help_user_platform=this.option.help_user_platform);var r=this;return e.getLocation({type:"wgs84",success:function(o){if(t.location=o.longitude+","+o.latitude,r.jwdxx=o.longitude+","+o.latitude,!r.is_request_ok)return e.hideLoading(),e.showToast({title:"请耐心等待...",icon:"none",duration:2e3}),!1;r.is_request_ok=!1,console.log("pay_time",r.option.pay_time),"a"!=r.option.pay_time?"b"==r.option.pay_time&&(e.hideLoading(),r.$request("/food/User/getUserInfo").then((function(e){r.userMoney=e.money,r.payShow=!0,r.is_request_ok=!0}))):r.visOrderId?(e.showModal({title:"订单提示",content:"当前订单已提交，是否查看详情？",confirmText:"查看详情",cancelText:"立即支付",success:function(o){o.confirm?(console.log("用户点击了【查看详情】"),r.clearShopDel(),e.removeStorageSync("workerOrder"),e.reLaunch({url:"/order_packages/cpxdz/index?order="+o.order_id})):o.cancel&&(console.log("用户点击了【立即支付】"),e.hideLoading(),r.$request("/food/User/getUserInfo").then((function(e){r.userMoney=e.money,r.payShow=!0,r.is_request_ok=!0})))}}),setTimeout((function(){r.is_request_ok=!0}),4e3)):r.$request("/food/Order/createOrder",t).then((function(o){console.log("结果",o),setTimeout((function(){e.hideLoading()}),2e3),1===o.result?(r.visOrderId=o.order_id,e.showModal({title:"订单提示",content:"当前订单已提交，是否查看详情？",confirmText:"查看详情",cancelText:"立即支付",success:function(o){o.confirm?(console.log("用户点击了【查看详情】"),r.clearShopDel(),e.removeStorageSync("workerOrder"),e.reLaunch({url:"/order_packages/cpxdz/index?order="+o.order_id})):o.cancel&&(console.log("用户点击了【立即支付】"),e.hideLoading(),r.$request("/food/User/getUserInfo").then((function(e){r.userMoney=e.money,r.payShow=!0,r.is_request_ok=!0})))}}),setTimeout((function(){r.is_request_ok=!0}),4e3)):(e.showToast({title:"下单失败",icon:"error",duration:2e3}),r.is_request_ok=!0)}))},fail:function(o){if(console.log("获取位置失败：",o),console.log("that.jwdxx",r.jwdxx),r.jwdxx.length>0);else{if(t.location=e.getStorageSync("mr_location")?e.getStorageSync("mr_location"):"",!r.is_request_ok)return e.hideLoading(),e.showToast({title:"请耐心等待...",icon:"none",duration:2e3}),!1;if(r.is_request_ok=!1,console.log("pay_time",r.option.pay_time),console.log("pay_time",r.option.pay_time),"a"==r.option.pay_time)return void(r.visOrderId?(e.showModal({title:"订单提示",content:"当前订单已提交，是否查看详情？",confirmText:"查看详情",cancelText:"立即支付",success:function(o){o.confirm?(console.log("用户点击了【查看详情】"),r.clearShopDel(),e.removeStorageSync("workerOrder"),e.reLaunch({url:"/order_packages/cpxdz/index?order="+o.order_id})):o.cancel&&(console.log("用户点击了【立即支付】"),e.hideLoading(),r.$request("/food/User/getUserInfo").then((function(e){r.userMoney=e.money,r.payShow=!0,r.is_request_ok=!0})))}}),setTimeout((function(){r.is_request_ok=!0}),4e3)):r.$request("/food/Order/createOrder",t).then((function(o){console.log("结果",o),setTimeout((function(){e.hideLoading()}),2e3),1===o.result?(r.visOrderId=o.order_id,e.showModal({title:"订单提示",content:"当前订单已提交，是否查看详情？",confirmText:"查看详情",cancelText:"立即支付",success:function(o){o.confirm?(console.log("用户点击了【查看详情】"),r.clearShopDel(),e.removeStorageSync("workerOrder"),e.reLaunch({url:"/order_packages/cpxdz/index?order="+o.order_id})):o.cancel&&(console.log("用户点击了【立即支付】"),e.hideLoading(),r.$request("/food/User/getUserInfo").then((function(e){r.userMoney=e.money,r.payShow=!0,r.is_request_ok=!0})))}}),setTimeout((function(){r.is_request_ok=!0}),4e3)):(e.showToast({title:"下单失败",icon:"error",duration:2e3}),r.is_request_ok=!0)})));"b"==r.option.pay_time&&(e.hideLoading(),r.$request("/food/User/getUserInfo").then((function(e){r.userMoney=e.money,r.payShow=!0,r.is_request_ok=!0})))}}}),!1}this.$request("/food/User/getUserInfo").then((function(e){o.userMoney=e.money,o.payShow=!0}))}else e.showToast({title:"商品为空",icon:"error"});else e.showToast({title:"请先选择餐位号",icon:"error"})},tc_confirm:function(){var o=this;if(this.payFlag){this.payFlag=!1;var t="";1===this.checkValue[0]?1===this.payType?t="d":2===this.payType&&(t="b"):0===this.checkValue.length&&(1===this.payType?t="c":2===this.payType&&(t="a"));var r=a(a(a({},this.orderForm),this.formData),{},{location:""});console.log(r),console.log("打印订单号",this.visOrderId),this.visOrderId?this.$request("/food/Order/payOrder",{order_id:this.visOrderId,coupon_id:this.orderForm.coupon_id,pay_type:t}).then((function(t){1===t.result?(o.clearShopDel(),e.showToast({title:"支付成功",icon:"success",duration:2e3}),setTimeout((function(){o.addType?e.reLaunch({url:"/order_packages/cpxdz/index?order="+res.order_id}):e.switchTab({url:"/pages/Order/index"})}),2e3)):3===t.result?(o.clearShopDel(),e.requestPayment(a(a({provider:"wxpay"},t.pay_data),{},{success:function(t){e.showToast({title:"支付成功",icon:"success",duration:2e3}),setTimeout((function(){o.addType?e.reLaunch({url:"/order_packages/cpxdz/index?order="+t.order_id}):e.switchTab({url:"/pages/Order/index"})}),2e3)},fail:function(){e.showToast({title:"用户取消支付",icon:"error"}),o.payFlag=!0}}))):(o.payFlag=!0,e.showToast({title:"支付失败",icon:"error",duration:2e3}))})).catch((function(){o.payFlag=!0})):this.$request("/food/Order/createOrder",r).then((function(r){o.visOrderId=r.order_id,1===r.result?(o.clearShopDel(),e.removeStorageSync("shop"+o.store_id),o.$request("/food/Order/payOrder",{order_id:r.order_id,coupon_id:o.orderForm.coupon_id,pay_type:t}).then((function(t){1===t.result?(o.clearShopDel(),e.showToast({title:"支付成功",icon:"success",duration:2e3}),setTimeout((function(){o.addType?e.reLaunch({url:"/order_packages/cpxdz/index?order="+r.order_id}):e.switchTab({url:"/pages/Order/index"})}),2e3)):3===t.result?(o.clearShopDel(),e.requestPayment(a(a({provider:"wxpay"},t.pay_data),{},{success:function(t){e.showToast({title:"支付成功",icon:"success",duration:2e3}),setTimeout((function(){o.addType?e.reLaunch({url:"/order_packages/cpxdz/index?order="+t.order_id}):e.switchTab({url:"/pages/Order/index"})}),2e3)},fail:function(){e.showToast({title:"用户取消支付",icon:"error"}),o.payFlag=!0}}))):(o.payFlag=!0,e.showToast({title:"支付失败",icon:"error",duration:2e3}))})).catch((function(){o.payFlag=!0}))):(o.payFlag=!0,e.showToast({title:"下单失败",icon:"error",duration:1e3}))})).catch((function(){o.payFlag=!0}))}}}};o.default=d}).call(this,t("df3c")["default"],t("3223")["default"])}},[["847f","common/runtime","common/vendor"]]]);