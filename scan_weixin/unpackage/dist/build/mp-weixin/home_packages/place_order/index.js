(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["home_packages/place_order/index"],{"30f7":function(e,o,t){"use strict";t.r(o);var n=t("f6a3"),i=t("38fe");for(var r in i)["default"].indexOf(r)<0&&function(e){t.d(o,e,(function(){return i[e]}))}(r);t("6304");var s=t("828b"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);o["default"]=u.exports},3127:function(e,o,t){},"38fe":function(e,o,t){"use strict";t.r(o);var n=t("c63e"),i=t.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){t.d(o,e,(function(){return n[e]}))}(r);o["default"]=i.a},6304:function(e,o,t){"use strict";var n=t("3127"),i=t.n(n);i.a},c340:function(e,o,t){"use strict";(function(e,o){var n=t("47a9");t("5e4b");n(t("3240"));var i=n(t("30f7"));e.__webpack_require_UNI_MP_PLUGIN__=t,o(i.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},c63e:function(e,o,t){"use strict";(function(e){var n=t("47a9");Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=n(t("7ca3")),r=t("835e");function s(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?s(Object(t),!0).forEach((function(o){(0,i.default)(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}var c={components:{cityPicker:function(){t.e("uni_modules/piaoyi-cityPicker/components/piaoyi-cityPicker/piaoyi-cityPicker").then(function(){return resolve(t("500e"))}.bind(null,t)).catch(t.oe)}},data:function(){return{defaultValue:"",store_id:"",table_code:"",tableList:[],tableShow:!1,formData:{goods_list:[]},numberShow:!0,orderForm:{store_id:"",coupon_id:"",table_id:"",person_number:1,remark:"",goods_list:[],order_id:""},goodsList:[],discountShow:!1,discountFirst:!1,discountList:[],status:{a:"平台通用",b:"品牌通用",c:"门店通用",d:"分类通用",e:"菜品限定",f:"套餐限定"},moneyObj:{},confirmFlag:!0,addType:!1,useCoupon:!1,orderId:"",orderResult:!1,checkValue:[1],checkValue1:[],payShow:!1,payType:2,payFlag:!0,userMoney:0,workerType:!1,option:{},is_request_ok:!0}},onLoad:function(o){var t=this;console.log("options",o),this.option=o,this.workerType=!0,o.addType&&(this.table_code=o.canwei,this.orderForm.order_id=o.orderId,console.log(o.useCoupon),setTimeout((function(){var e=t.tableList.filter((function(e){return e.code==o.canwei}));t.orderForm.table_id=e[0].id}),1e3),this.addType=!0,this.useCoupon="false"!==o.useCoupon,this.orderId=o.orderId),e.getStorageSync("person_number")&&(this.orderForm.person_number=e.getStorageSync("person_number").person_number,this.numberShow=!1),o.workerType&&(this.workerType=!0),this.goodsList=e.getStorageSync("shop"+o.id)||[],this.orderForm.store_id=o.id,this.$request("/food/Seat/geSeatList2",{store_id:o.id}).then((function(e){if(t.tableList=e.list,o.seat_id){var n=e.list.filter((function(e){return e.id==o.seat_id}));t.orderForm.table_id=n[0].id,t.table_code=n[0].code,console.log("obj",n)}})),this.store_id=o.id,this.changePayData(),this.selectCount("first")},methods:{discountClose:function(){this.discountShow=!1,1!==this.checkValue1[0]&&(this.checkValue=[])},scanCode:function(){var o=this;e.scanCode({scanType:["qrCode"],success:function(e){console.log("res",e);for(var t=e.result.split("?")[1],n={},i=t.split("&"),r=0;r<i.length;r++)n[i[r].split("=")[0]]=i[r].split("=")[1];o.orderForm.table_id=n.seat_id,o.table_code=n.seat_code,o.$request("/food/Order/userGetOrderDetailByTableID",{table_id:n.seat_id}).then((function(e){e.order_id&&o.$nav("/order_packages/detail/index",{id:e.order_id,time_status:"",pay_status:""})}))}})},selectTable:function(){if(console.log("baseUrl",r.baseUrl),"https://test.api.xzddd.com"!=r.baseUrl)return!1;console.log("测试地址"),this.tableShow=!0},tableConfirm:function(e){var o=this.tableList[e];console.log("确定",o.code),o&&(this.orderForm.table_id=o.id,this.table_code=o.code),this.tableShow=!1},changePayData:function(){var e=this;this.goodsList.length?this.formData.goods_list=this.goodsList.map((function(e){return(0,i.default)({goods_type:1===e.type?"b":"a",goods_id:e.info.id,number:e.num,choice_des:e.choice_des},e.info.group_goods?"group_goods":"",e.info.group_goods)})):this.formData.goods_list=[],this.$request("/food/Order/computePayData",{goods_list:this.formData.goods_list,coupon_id:this.orderForm.coupon_id,pay_type:1===this.checkValue[0]?"b":"a"}).then((function(o){e.moneyObj=o}))},changePeopleNum:function(e){if("add"===e)this.orderForm.person_number+=1;else{if(1===this.orderForm.person_number)return;this.orderForm.person_number-=1}},trash:function(o){var t=this;e.showModal({title:"温馨提示",content:"确认删除吗？",success:function(n){n.confirm&&(t.goodsList.splice(o,1),e.setStorageSync("shop"+t.store_id,t.goodsList),t.changePayData())}})},changeCarNum:function(o,t,n){"add"===t?o.num+=1:"min"===t&&(1===o.num?this.goodsList.splice(n,1):o.num-=1),e.setStorageSync("shop"+this.store_id,this.goodsList),this.changePayData()},selectCount:function(e){var o=this,t=[];this.goodsList.length&&(t=this.goodsList.map((function(e){return(0,i.default)({goods_type:1===e.type?"b":"a",goods_id:e.info.id,number:e.num,choice_des:e.choice_des},e.group_goods?"group_goods":"",e.group_goods)}))),this.$request("/food/Coupon/getOrderCoupon",{store_id:this.store_id,goods_list:t}).then((function(t){o.discountList=t.list,o.workerType||(o.discountFirst="first"===e,"first"===e&&0===o.discountList.length?o.discountShow=!1:o.discountShow=!0)}))},changePayType:function(e){this.payType=e},getCoupon:function(e){var o=this;this.$request("/food/Coupon/hasCoupon",{coupon_id:e.id}).then((function(){o.selectCount()}))},useCouponEven:function(e){this.orderForm.coupon_id=e.id,this.discountShow=!1,this.changePayData()},checkboxChange:function(e){this.checkValue=e,this.changePayData()},order:function(){var o=this;if(this.table_code)if(0!==this.goodsList.length){if(this.workerType){e.showLoading({title:"请稍后……"});var t=u(u(u({},this.orderForm),this.formData),{},{location:""});this.option.help_user_order&&(t.help_user_order=this.option.help_user_order),this.option.help_user_coupon&&(t.help_user_coupon=this.option.help_user_coupon),this.option.help_user_platform&&(t.help_user_platform=this.option.help_user_platform);var n=this;return e.getLocation({type:"wgs84",success:function(o){if(console.log("经度："+o.longitude),console.log("纬度："+o.latitude),t.location=o.longitude+","+o.latitude,!n.is_request_ok)return e.hideLoading(),e.showToast({title:"请耐心等待...",icon:"none",duration:2e3}),!1;n.is_request_ok=!1,console.log("pay_time",n.option.pay_time),"a"!=n.option.pay_time?"b"==n.option.pay_time&&n.$request("/food/User/getUserInfo").then((function(e){n.userMoney=e.money,n.payShow=!0,n.is_request_ok=!0})):n.$request("/food/Order/createOrder",t).then((function(o){console.log("结果",o),setTimeout((function(){e.hideLoading()}),2e3),1===o.result?(e.removeStorageSync("shop"+n.store_id),e.removeStorageSync("workerOrder"),n.$nav("/order_packages/cpxdz/index",{order:o.order_id})):e.showToast({title:"下单失败",icon:"error",duration:2e3}),setTimeout((function(){n.is_request_ok=!0}),4e3)}))},fail:function(e){console.log("获取位置失败：",e)}}),!1}this.$request("/food/User/getUserInfo").then((function(e){o.userMoney=e.money,o.payShow=!0}))}else e.showToast({title:"商品为空",icon:"error"});else e.showToast({title:"请先选择餐位号",icon:"error"})},confirm:function(){var o=this;if(this.payFlag){this.payFlag=!1;var t="";1===this.checkValue[0]?1===this.payType?t="d":2===this.payType&&(t="b"):0===this.checkValue.length&&(1===this.payType?t="c":2===this.payType&&(t="a"));var n=u(u(u({},this.orderForm),this.formData),{},{location:""});console.log(n),this.$request("/food/Order/createOrder",n).then((function(n){1===n.result?(e.removeStorageSync("shop"+o.store_id),o.$request("/food/Order/payOrder",{order_id:n.order_id,coupon_id:o.orderForm.coupon_id,pay_type:t}).then((function(t){1===t.result?(e.showToast({title:"支付成功",icon:"success",duration:2e3}),setTimeout((function(){o.addType?o.$nav("/order_packages/cpxdz/index",{order:n.order_id}):e.switchTab({url:"/pages/Order/index"})}),2e3)):3===t.result?e.requestPayment(u(u({provider:"wxpay"},t.pay_data),{},{success:function(t){e.showToast({title:"支付成功",icon:"success",duration:2e3}),setTimeout((function(){o.addType?o.$nav("/order_packages/cpxdz/index",{order:t.order_id}):e.switchTab({url:"/pages/Order/index"})}),2e3)},fail:function(){e.showToast({title:"用户取消支付",icon:"error"}),o.payFlag=!0}})):(o.payFlag=!0,e.showToast({title:"支付失败",icon:"error",duration:2e3}))})).catch((function(){o.payFlag=!0}))):(o.payFlag=!0,e.showToast({title:"下单失败",icon:"error",duration:1e3}))})).catch((function(){o.payFlag=!0}))}}}};o.default=c}).call(this,t("df3c")["default"])},f6a3:function(e,o,t){"use strict";t.d(o,"b",(function(){return i})),t.d(o,"c",(function(){return r})),t.d(o,"a",(function(){return n}));var n={uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,"2b07"))},uPopup:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-popup/u-popup")]).then(t.bind(null,"829e"))},uCheckboxGroup:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-checkbox-group/u-checkbox-group")]).then(t.bind(null,"0e68"))},uCheckbox:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-checkbox/u-checkbox")]).then(t.bind(null,"9c94"))},uEmpty:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-empty/u-empty")]).then(t.bind(null,"c813"))}},i=function(){var e=this,o=e.$createElement,t=(e._self._c,!e.discountList||0===e.discountList.length),n=!e.discountList||0===e.discountList.length,i=e.__map(e.discountList,(function(o,t){var n=e.__get_orig(o),i="a"===o.discount_type?o.top_price.replace(".00",""):null,r="a"===o.discount_type?o.data.replace(".00",""):null;return{$orig:n,g2:i,g3:r}}));e._isMounted||(e.e0=function(o){e.payShow=!1},e.e1=function(o){e.payShow=!1},e.e2=function(o){e.tableShow=!1}),e.$mp.data=Object.assign({},{$root:{g0:t,g1:n,l0:i}})},r=[]}},[["c340","common/runtime","common/vendor"]]]);