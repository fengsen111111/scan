(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/Mine/index"],{"0f14":function(e,n,t){},"354b":function(e,n,t){"use strict";var o=t("0f14"),a=t.n(o);a.a},6186:function(e,n,t){"use strict";(function(e,n){var o=t("47a9");t("5e4b");o(t("3240"));var a=o(t("b4ba"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(a.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},"84ac":function(e,n,t){"use strict";t.r(n);var o=t("c9f1"),a=t.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(r);n["default"]=a.a},b4ba:function(e,n,t){"use strict";t.r(n);var o=t("d8c7"),a=t("84ac");for(var r in a)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return a[e]}))}(r);t("354b");var i=t("828b"),s=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);n["default"]=s.exports},c9f1:function(e,n,t){"use strict";(function(e){var o=t("47a9");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=o(t("7eb4")),r=o(t("ee10")),i={components:{CanvasImage:function(){Promise.all([t.e("common/vendor"),t.e("components/CanvasImage")]).then(function(){return resolve(t("aae3"))}.bind(null,t)).catch(t.oe)}},data:function(){return{statusBarHeight:0,navHeight:0,navigationBarHeight:0,qrCodeShow:!1,userInfo:{id:"",nickname:"",head_image:"",money:"",all_share_money:"",share_money:"",coupon_number:"",collection_number:"",share_image:"",is_worker:"",store_id:""},integral:0,accpet:!1,canvasShow:!1}},onLoad:function(n){if(n.scene){for(var t=decodeURIComponent(n.scene),o=t.split("?")[1],a={},r=o.split("&"),i=0;i<r.length;i++)a[r[i].split("=")[0]]=r[i].split("=")[1];"1"===a.zysk&&e.setStorageSync("pid",a.pid)}var s=getApp().globalData;this.statusBarHeight=s.statusBarHeight,this.navigationBarHeight=s.navigationBarHeight,this.navHeight=s.navHeight},onShow:function(){e.getStorageSync("token")&&this.getUserInfo()},methods:{login:function(){var n=this;return(0,r.default)(a.default.mark((function t(){var o,r,i,s,c,u;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.login();case 2:return o=t.sent,r=o.code,t.next=6,n.$request("/factory_system/Base/wechatUserRegister",{code:r,platform:"mini"});case 6:return i=t.sent,s=i.mini_openid,e.setStorageSync("openId",s),t.next=11,n.$request("/food/User/loginAndRegister",{openid:s});case 11:c=t.sent,u=c.token,e.setStorageSync("token",u),n.getUserInfo();case 15:case"end":return t.stop()}}),t)})))()},getPhone:function(n){var t=this;return(0,r.default)(a.default.mark((function o(){var r,i,s;return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return r=n.detail.code,o.next=3,t.$request("/factory_system/Base/getWechatPhoneNumber",{platform:"mini",code:r,mini_openid:e.getStorageSync("openId")});case 3:return i=o.sent,s=i.phone_number,t.userInfo.mobile=s,o.next=8,t.$request("/food/User/updateUserInfo",{mobile:s});case 8:case"end":return o.stop()}}),o)})))()},getUserInfo:function(){var n=this;return(0,r.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.getStorageSync("pid")){t.next=9;break}return t.next=3,n.$request("/food/User/getUserInfo",{pid:e.getStorageSync("pid")});case 3:n.userInfo=t.sent,"Y"===n.userInfo.need_wechat_notice?n.accpet=!0:n.accpet=!1,n.$request("/food/User/getUserIntegral").then((function(e){n.integral=e.integral})),e.removeStorageSync("pid"),t.next=14;break;case 9:return t.next=11,n.$request("/food/User/getUserInfo");case 11:n.userInfo=t.sent,"Y"===n.userInfo.need_wechat_notice?n.accpet=!0:n.accpet=!1,n.$request("/food/User/getUserIntegral").then((function(e){n.integral=e.integral}));case 14:case"end":return t.stop()}}),t)})))()},changeAvatar:function(n){var t=this;e.showLoading({title:"上传中，请稍后……"});var o=n.detail.avatarUrl.split("/"),a=o[o.length-1];this.$request("",{file:n.detail.avatarUrl,fileType:"file",params:{fileSize:0,fileName:a}}).then((function(n){t.$request("/food/User/updateUserInfo",{head_image:n.url}).then((function(){e.hideLoading(),t.getUserInfo()}))})),e.hideLoading()},changeNickname:function(){var e=this;setTimeout((function(){e.$request("/food/User/updateUserInfo",{nickname:e.userInfo.nickname}).then((function(){e.getUserInfo()}))}),200)},save:function(){this.userInfo.share_image&&e.downloadFile({url:this.userInfo.share_image,success:function(){var n=(0,r.default)(a.default.mark((function n(t){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.saveImageToPhotosAlbum({filePath:t.tempFilePath});case 2:e.showToast({title:"保存成功",icon:"success"});case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()})},changeSwitch:function(){var e=this;this.$request("/food/User/changeSendNoticeStatus",{need_wechat_notice:this.accpet?"Y":"N"}).then((function(n){n.already_follow_offical_count&&"N"===n.already_follow_offical_count&&(console.log(encodeURIComponent(e.userInfo.wechat_host+"/?type=wechat&user_id"+e.userInfo.id)),e.$nav("/pages/WebPage/index",{url:encodeURIComponent(e.userInfo.wechat_host+"/?type=wechat&user_id="+e.userInfo.id)}))}))},openShare:function(){this.canvasShow=!0}}};n.default=i}).call(this,t("df3c")["default"])},d8c7:function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return r})),t.d(n,"a",(function(){return o}));var o={uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,"2b07"))},uSwitch:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-switch/u-switch")]).then(t.bind(null,"47df"))}},a=function(){var e=this,n=e.$createElement,o=(e._self._c,e.userInfo.head_image||t("1898"));e._isMounted||(e.e0=function(n){e.qrCodeShow=!1},e.e1=function(n){e.qrCodeShow=!1},e.e2=function(n){e.canvasShow=!1}),e.$mp.data=Object.assign({},{$root:{m0:o}})},r=[]}},[["6186","common/runtime","common/vendor"]]]);